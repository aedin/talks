<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script>
<style type="text/css" scoped>
body {
  margin: 0px auto;
  max-width: 1134px;
  font-family: sans-serif;
  font-size: 10pt;
}

/* Table of contents style */

div#TOC ul {
  padding: 0px 0px 0px 45px;
  list-style: none;
  background-image: none;
  background-repeat: none;
  background-position: 0;
  font-size: 10pt;
  font-family: Helvetica, Arial, sans-serif;
}

div#TOC > ul {
  padding: 0px 150px 0px 65px;
  font-size: 12pt;
}

div#TOC > ul > li {
  padding: 5px 0px 0px 0px;
}

div#TOC ul ul {
  font-size: 11pt;
}

div#TOC.tocify ul {
  padding: 0px;
  font-size: inherit;
  font-family: inherit;
}

div#TOC.tocify li {
  padding: 5px;
  font-size: inherit;
  font-family: inherit;
}

p, dl {
  padding: 0px 150px 0px 65px;
  text-align: justify;
}

/* vertical content spacing */
p, img, table {
  margin-top: 10px;
  margin-bottom: 10px;
}

/* lists */
ol, ul {
  padding: 0px 150px 0px 100px;
  list-style: square;
}

li ol, li ul {
  padding: 0px 0px 0px 35px;
}

li p {
  padding: 0;
}

pre {
  margin: 0em 150px 0.5em 0em;
  padding: 0px 0px 0px 65px;
  border: 0px none;
  background-color: #f0f0f0;
  white-space: pre;
  overflow-x: auto;
  font-size: 90%;
}

li pre {
  margin: 0em 0px 0.5em -65px;
  padding: 0px 0px 0px 65px;
}
pre code {
  background-color: inherit;
  display: block;
  padding: 10px 10px 10px 0px;
  overflow-x: inherit;
  font-size: 100%;
}

/* markdown v1 */
pre code[class] {
  background-color: inherit;
}

/* markdown v2 */
pre[class] code {
  background-color: inherit;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1, h2, h3, h4, h5, h6 { 
  font-family: Helvetica, Arial, sans-serif;
  margin: 1.2em 150px 0.6em 0em;
/* hanging headings */
  padding-left: 65px;
  text-indent: -65px;
}

h1.title {
  color: #87b13f;
  line-height: 1.1em;
  margin-top: 25px;
  border-bottom: 0px;
}

h1 {
  line-height: 1.4em;
  border-bottom: 1px #1a81c2 solid;
}

h1, h2, h3 {
  color: #1a81c2;
}

h1 {
  font-size: 18.0pt;
}

h2 {
  font-size: 14.5pt;
}

h3, h4 {
  font-size: 12pt;
}

span.header-section-number {
  float: left;
  width: 65px;
}

/* document header */

p.author-name {
  font-size: 14.5pt;
  font-weight: bold;
  font-style: italic;
  text-align: left;
}

.date {
  text-indent: 0px;
  font-weight: bold;
}

.abstract, .package {
  font-weight: bold;
}

/* formatting of inline code */
code { 
  background-color: #f0f0f0;
  color: #404040;
  font-size: 90%;
}

/* figures */

.figure { 
  margin: 0em 0px 0.5em;
}

img {
  max-width: 100%;
  display: block;
  padding: 0px 150px 0px 130px;
}

p > img {
  padding-left: 65px;
  padding-right: 0px;
}

img.smallfigure {
  padding-left: 195px;
  padding-right: 280px;
}

p > img.smallfigure {
  padding-left: 130px;
  padding-right: 130px;
}

img.widefigure {
  padding-left: 65px;
  padding-right: 85px;
  margin-right: -65px;
}

p > img.widefigure {
  padding-left: 0px;
  padding-right: 0px;
  margin-right: -65px;
}

p.caption, caption {
  color: inherit;
  font-size: 8pt;
}

p.caption {
  padding-left: 130px;
  padding-right: 85px;
  margin-bottom: 20px;
}

caption {
  padding: 0px;
  margin-bottom: 10px;
  min-width: 583;
}
span.caption-title {
  color: #1a81c2;
  font-weight: bold;
}

span.caption-label {
  font-weight: bold;
}

/* tables */

table {
  margin-left: 130px;
  margin-right: 85px;
}

.table {
  max-width: 518px;
}

/* definition lists */

dd {
  margin-left: 65px;
  margin-bottom: 10px;
}

/* code folding buttons */

.code-folding-btn {
  position: relative;
  margin-top: -26px;
  top: 26px;
}

.col-md-12 {
  min-height: 0px;
}

/* footnotes as sidenotes */

.sidenote {
  float: right;
  clear: right;
  margin-right: -150px;
  width: 130px;
  margin-top: 0;
  margin-bottom: 1rem;
  font-size: 8pt;
  line-height: 1.3;
  vertical-align: baseline;
  position: relative;
  text-align: left;
}

.sidenote-number, .affil-mark {
  position: relative;
  vertical-align: super;
  font-size: 7.5pt;
  font-weight: normal;
  font-style: normal;
  line-height: normal;
}

input.margin-toggle { display: none; }

label.sidenote-number { display: inline; }

label.margin-toggle:not(.sidenote-number) { display: none; }

/* Class described in https://benjeffrey.com/posts/pandoc-syntax-highlighting-css
   Colours from https://gist.github.com/robsimmons/1172277 */

code > span.kw { color: #E07020; } /* Function calls */
code > span.dt { color: #404040; } /* Function args */
code > span.dv { color: #D02070; } /* DecVal (decimal values) */
code > span.bn { color: #d14; } /* BaseN */
code > span.fl { color: #D02070; } /* Float */
code > span.ch { color: #40A040; } /* Char */
code > span.st { color: #40A040; } /* String */
code > span.co { color: #808080; font-style: italic; } /* Comment */
code > span.ot { color: #2020F0; } /* Keywords */
code > span.al { color: #ff0000; font-weight: bold; } /* AlertToken */
code > span.fu { color: #E07020; } /* Function calls */ 
code > span.er { color: #FF0000; } /* ErrorTok */

code > span.identifier { color: #404040; }
code > span.number { color: #D02070; }
code > span.string { color: #40A040; }
code > span.comment { color: #808080; font-style: italic; }
code > span.keyword { color: #2020F0; }
code > span.literal { color: #2020F0; }
code > span.operator { color: #000000;}
code > span.paren { color: #000000;}

/* proper positioning of ggplotly graphics, see https://support.bioconductor.org/p/97609/ */

.js-plotly-plot .plotly {
  padding-left: 65px;
}
</style>
<h1 id="pca-in-r">PCA in R</h1>
<p>In R, there are several functions from different packages that allow us to perform PCA. These include;</p>
<ul>
<li>svd() (stats) *** on centered data**</li>
<li>prcomp() (stats)</li>
<li>princomp() (stats) ** on cor matrix **</li>
<li>PCA() (FactoMineR)</li>
<li>dudi.pca() (ade4)</li>
</ul>
<p><strong>Note, although prcomp sets scale=FALSE for consistency with S, in general scaling is advised. We will demonstrate first pca of unscaled and then scaled data. Scaling scaled the variables to have unit variance and is advised before analysis takes place.</strong></p>
<p>We will demonstrate some of these and explore these using exploR</p>
<h1 id="equivalents-across-methods">Equivalents across methods</h1>
<p>Give an input matrix P and result res</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Function</th>
<th style="text-align: left;">loadings</th>
<th style="text-align: left;">scores</th>
<th style="text-align: left;">plot</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">prcomp(P, center=TRUE, scale=TRUE)</td>
<td style="text-align: left;">res$rotation</td>
<td style="text-align: left;">res$x</td>
<td style="text-align: left;">biplot(res)</td>
</tr>
<tr class="even">
<td style="text-align: left;">princomp(P, cor=TRUE)</td>
<td style="text-align: left;">res$loadings</td>
<td style="text-align: left;">res$scores</td>
<td style="text-align: left;">biplot(res)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PCA(P)</td>
<td style="text-align: left;">res$svd$V</td>
<td style="text-align: left;">res$ind$coord</td>
<td style="text-align: left;">plot(res)</td>
</tr>
<tr class="even">
<td style="text-align: left;">dudi.pca(P, center=TRUE, scale=TRUE)</td>
<td style="text-align: left;">res$c1</td>
<td style="text-align: left;">res$li</td>
<td style="text-align: left;">scatter(res)</td>
</tr>
</tbody>
</table>
<p>With ade4::dudi.pca and prcomp the default is center = TRUE, scale = TRUE.But with princomp, cor=FALSE by default.</p>
<h1 id="toy-data">Toy data</h1>
<p>Create a cloud of points; two vectors, x,y of length 100.</p>
<pre class="sourceCode r" id="cb1"><code class="sourceCode r"><div class="sourceLine" id="cb1-1" data-line-number="1"> <span class="kw">set.seed</span>(<span class="dv">2</span>)             <span class="co">#sets the seed for random number generation.</span></div>
<div class="sourceLine" id="cb1-2" data-line-number="2"> x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">100</span>              <span class="co">#creates a vector x with numbers from 1 to 100</span></div>
<div class="sourceLine" id="cb1-3" data-line-number="3"> ex &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">30</span>) <span class="co">#100 normally distributed random numbers, mean=0, sd=30</span></div>
<div class="sourceLine" id="cb1-4" data-line-number="4"> ey &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">30</span>) <span class="co"># 100 normally distributed random numbers, mean=0, sd=30</span></div>
<div class="sourceLine" id="cb1-5" data-line-number="5"> y &lt;-<span class="st"> </span><span class="dv">30</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>x         <span class="co">#sets y to be a vector that is a linear function of x</span></div>
<div class="sourceLine" id="cb1-6" data-line-number="6"> x_obs &lt;-<span class="st"> </span>x <span class="op">+</span><span class="st"> </span>ex         <span class="co">#adds &quot;noise&quot; to x</span></div>
<div class="sourceLine" id="cb1-7" data-line-number="7"> y_obs &lt;-<span class="st"> </span>y <span class="op">+</span><span class="st"> </span>ey         <span class="co">#adds &quot;noise&quot; to y</span></div>
<div class="sourceLine" id="cb1-8" data-line-number="8"> <span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</div>
<div class="sourceLine" id="cb1-9" data-line-number="9"> <span class="kw">hist</span>(x_obs)</div>
<div class="sourceLine" id="cb1-10" data-line-number="10"> <span class="kw">hist</span>(y_obs)</div></code></pre>
<figure>
<img src="figure/unnamed-chunk-1-1.png" alt="plot of chunk unnamed-chunk-1" /><figcaption>plot of chunk unnamed-chunk-1</figcaption>
</figure>
<p>Save both vectors in a matrix of toy data called P</p>
<pre class="sourceCode r" id="cb2"><code class="sourceCode r"><div class="sourceLine" id="cb2-1" data-line-number="1">P &lt;-<span class="st"> </span><span class="kw">cbind</span>(x_obs,y_obs) <span class="co">#places points in matrix</span></div>
<div class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">summary</span>(P)</div></code></pre>
<pre><code>##      x_obs            y_obs       
##  Min.   :-53.33   Min.   : 14.13  
##  1st Qu.: 21.44   1st Qu.: 97.22  
##  Median : 44.37   Median :134.91  
##  Mean   : 49.58   Mean   :131.88  
##  3rd Qu.: 77.91   3rd Qu.:174.29  
##  Max.   :155.78   Max.   :252.63</code></pre>
<p>Plot x,y. Show center (mean (x), mean(y)) on plot</p>
<pre class="sourceCode r" id="cb4"><code class="sourceCode r"><div class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">plot</span>(P,<span class="dt">asp=</span><span class="dv">1</span>,<span class="dt">col=</span><span class="dv">1</span>) <span class="co">#plot points</span></div>
<div class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">points</span>(<span class="dt">x=</span><span class="kw">mean</span>(x_obs),<span class="dt">y=</span><span class="kw">mean</span>(y_obs),<span class="dt">col=</span><span class="st">&quot;orange&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>) <span class="co">#show center</span></div></code></pre>
<figure>
<img src="figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /><figcaption>plot of chunk unnamed-chunk-3</figcaption>
</figure>
<h1 id="computing-via-svd-of-unscaled-centered-covariance-matrix">Computing via svd of <strong>unscaled</strong>, centered, covariance matrix</h1>
<p>PCA can be computed as a singular value decomposition of a column centered matrix. Therefore we first processs the matrix. In this example, we don’t scale. This is not advised.</p>
<pre class="sourceCode r" id="cb5"><code class="sourceCode r"><div class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">#center matrix</span></div>
<div class="sourceLine" id="cb5-2" data-line-number="2">M &lt;-<span class="st"> </span><span class="kw">cbind</span>(x_obs<span class="op">-</span><span class="kw">mean</span>(x_obs),y_obs<span class="op">-</span><span class="kw">mean</span>(y_obs))</div>
<div class="sourceLine" id="cb5-3" data-line-number="3">Mx&lt;-<span class="st"> </span><span class="kw">scale</span>(P, <span class="dt">center=</span><span class="ot">TRUE</span>,<span class="dt">scale=</span><span class="ot">FALSE</span>)</div></code></pre>
<p>M equal to Mx, ignore col names</p>
<pre class="sourceCode r" id="cb6"><code class="sourceCode r"><div class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">all.equal</span>(M, Mx, <span class="dt">check.attributes=</span><span class="ot">FALSE</span>)  </div></code></pre>
<pre><code>## [1] TRUE</code></pre>
<h1 id="eigenvector-eigenvalues-of-the-centered-covariance-matrix">Eigenvector, Eigenvalues of the centered, covariance matrix</h1>
<p>The eigenvectors of the covariance matrix provide the principal axes, and the eigenvalues quantify the fraction of variance explained in each component.</p>
<p>creates covariance matrix</p>
<pre class="sourceCode r" id="cb8"><code class="sourceCode r"><div class="sourceLine" id="cb8-1" data-line-number="1">MCov &lt;-<span class="st"> </span><span class="kw">cov</span>(M) </div></code></pre>
<p>compute eigen values and vectors</p>
<pre class="sourceCode r" id="cb9"><code class="sourceCode r"><div class="sourceLine" id="cb9-1" data-line-number="1">eigenvalues &lt;-<span class="st"> </span><span class="kw">eigen</span>(MCov)<span class="op">$</span>values       </div>
<div class="sourceLine" id="cb9-2" data-line-number="2">eigenvalues</div></code></pre>
<pre><code>## [1] 4110.45 1189.45</code></pre>
<p>(This is the same as prcomp PCA of the unscaled data)</p>
<pre class="sourceCode r" id="cb11"><code class="sourceCode r"><div class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">prcomp</span>(P)<span class="op">$</span>sdev<span class="op">^</span><span class="dv">2</span> </div></code></pre>
<pre><code>## [1] 4110.45 1189.45</code></pre>
<p>and similar to princomp</p>
<pre class="sourceCode r" id="cb13"><code class="sourceCode r"><div class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">princomp</span>(P)<span class="op">$</span>sdev<span class="op">^</span><span class="dv">2</span>   </div></code></pre>
<pre><code>##   Comp.1   Comp.2 
## 4069.345 1177.556</code></pre>
<pre class="sourceCode r" id="cb15"><code class="sourceCode r"><div class="sourceLine" id="cb15-1" data-line-number="1">eigenVectors &lt;-<span class="st"> </span><span class="kw">eigen</span>(MCov)<span class="op">$</span>vectors     </div>
<div class="sourceLine" id="cb15-2" data-line-number="2">eigenVectors</div></code></pre>
<pre><code>##           [,1]       [,2]
## [1,] 0.4527354 -0.8916449
## [2,] 0.8916449  0.4527354</code></pre>
<p>which is equivalent to</p>
<pre class="sourceCode r" id="cb17"><code class="sourceCode r"><div class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">prcomp</span>(P)<span class="op">$</span>rotation</div></code></pre>
<pre><code>##             PC1        PC2
## x_obs 0.4527354 -0.8916449
## y_obs 0.8916449  0.4527354</code></pre>
<p>The right singular vectors are the eigenvectors of M<sup>t</sup>M. Next I plot the principal axes (yellow):</p>
<pre class="sourceCode r" id="cb19"><code class="sourceCode r"><div class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">plot</span>(P,<span class="dt">asp=</span><span class="dv">1</span>,<span class="dt">col=</span><span class="dv">1</span>) <span class="co">#plot points</span></div>
<div class="sourceLine" id="cb19-2" data-line-number="2"><span class="kw">points</span>(<span class="dt">x=</span><span class="kw">mean</span>(x_obs),<span class="dt">y=</span><span class="kw">mean</span>(y_obs),<span class="dt">col=</span><span class="st">&quot;orange&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>) <span class="co">#show center</span></div>
<div class="sourceLine" id="cb19-3" data-line-number="3"><span class="kw">lines</span>(x_obs,eigenVectors[<span class="dv">2</span>,<span class="dv">1</span>]<span class="op">/</span>eigenVectors[<span class="dv">1</span>,<span class="dv">1</span>]<span class="op">*</span>M[x]<span class="op">+</span><span class="kw">mean</span>(y_obs),<span class="dt">col=</span><span class="dv">8</span>)</div></code></pre>
<figure>
<img src="figure/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12" /><figcaption>plot of chunk unnamed-chunk-12</figcaption>
</figure>
<p>This shows the first principal axis. Note that it passes through the mean as expected. The ratio of the eigenvectors gives the slope of the axis.</p>
<p>Next plot the second principal axis, orthlogonal to the first</p>
<pre class="sourceCode r" id="cb20"><code class="sourceCode r"><div class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">plot</span>(P,<span class="dt">asp=</span><span class="dv">1</span>,<span class="dt">col=</span><span class="dv">1</span>) <span class="co">#plot points</span></div>
<div class="sourceLine" id="cb20-2" data-line-number="2"><span class="kw">points</span>(<span class="dt">x=</span><span class="kw">mean</span>(x_obs),<span class="dt">y=</span><span class="kw">mean</span>(y_obs),<span class="dt">col=</span><span class="st">&quot;orange&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>) <span class="co">#show center</span></div>
<div class="sourceLine" id="cb20-3" data-line-number="3"><span class="kw">lines</span>(x_obs,eigenVectors[<span class="dv">2</span>,<span class="dv">1</span>]<span class="op">/</span>eigenVectors[<span class="dv">1</span>,<span class="dv">1</span>]<span class="op">*</span>M[x]<span class="op">+</span><span class="kw">mean</span>(y_obs),<span class="dt">col=</span><span class="dv">8</span>)</div>
<div class="sourceLine" id="cb20-4" data-line-number="4"><span class="kw">lines</span>(x_obs,eigenVectors[<span class="dv">2</span>,<span class="dv">2</span>]<span class="op">/</span>eigenVectors[<span class="dv">1</span>,<span class="dv">2</span>]<span class="op">*</span>M[x]<span class="op">+</span><span class="kw">mean</span>(y_obs),<span class="dt">col=</span><span class="dv">8</span>)</div></code></pre>
<p><img src="figure/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13" /> shows the second principal axis, which is orthogonal to the first (recall that the matrix V<sup>t</sup> in the singular value decomposition is orthogonal). This can be checked by noting that the second principal axis is also</p>
<p>as the product of orthogonal slopes is -1.</p>
<h2 id="pca-scaled-data-using-svd">PCA (scaled data) using svd</h2>
<p>Singular value decomposition of M. The singular value decomposition of M decomposes it into M=UDV<sup>t</sup> where D is a diagonal matrix and both U and V<sup>t</sup> are orthogonal matrices.</p>
<p>The output is</p>
<p>d - a vector containing the singular values u - the left singular vectors v - the right singular vectors of x</p>
<p>The columns u from the SVD correspond to the principal components x in the PCA.</p>
<p>Furthermore, the matrix v from the SVD is equivalent to the rotation matrix returned by prcomp.</p>
<p>Now repeat the code above but <strong>scale</strong> and center the data scale(P, center=TRUE, scale=TRUE).</p>
<pre class="sourceCode r" id="cb21"><code class="sourceCode r"><div class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">any</span>(M <span class="op">==</span><span class="st"> </span><span class="kw">scale</span>(P))  <span class="co">#FALSE</span></div></code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="sourceCode r" id="cb23"><code class="sourceCode r"><div class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">all</span>(<span class="kw">scale</span>(P, <span class="dt">center=</span><span class="ot">TRUE</span>, <span class="dt">scale=</span><span class="ot">TRUE</span>)<span class="op">==</span><span class="st"> </span><span class="kw">scale</span>(P)) <span class="co">#TRUE</span></div></code></pre>
<pre><code>## [1] TRUE</code></pre>
<h3 id="scalep-centertrue-scaletrue">scale(P, center=TRUE, scale=TRUE)</h3>
<pre class="sourceCode r" id="cb25"><code class="sourceCode r"><div class="sourceLine" id="cb25-1" data-line-number="1">p0&lt;-<span class="kw">svd</span>(<span class="kw">scale</span>(P))</div>
<div class="sourceLine" id="cb25-2" data-line-number="2"></div>
<div class="sourceLine" id="cb25-3" data-line-number="3">p0<span class="op">$</span>d          <span class="co">#the singular values</span></div></code></pre>
<pre><code>## [1] 12.065827  7.239877</code></pre>
<pre class="sourceCode r" id="cb27"><code class="sourceCode r"><div class="sourceLine" id="cb27-1" data-line-number="1">p0<span class="op">$</span>v          <span class="co">#the right singular vectors</span></div></code></pre>
<pre><code>##           [,1]       [,2]
## [1,] 0.7071068 -0.7071068
## [2,] 0.7071068  0.7071068</code></pre>
<p>The eigenvalues are</p>
<pre class="sourceCode r" id="cb29"><code class="sourceCode r"><div class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">diag</span>(p0<span class="op">$</span>d)</div></code></pre>
<pre><code>##          [,1]     [,2]
## [1,] 12.06583 0.000000
## [2,]  0.00000 7.239877</code></pre>
<p>Which is</p>
<pre class="sourceCode r" id="cb31"><code class="sourceCode r"><div class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">diag</span>(<span class="kw">t</span>(p0<span class="op">$</span>u) <span class="op">%*%</span><span class="st"> </span>M <span class="op">%*%</span><span class="st"> </span>p0<span class="op">$</span>v)</div></code></pre>
<pre><code>## [1] 612.6218 367.5924</code></pre>
<p>Eigenvalues from svd on the scaled data. The diagonal elements of d from the SVD are proportional to the standard deviations (sdev) returned by PCA.</p>
<p>The elements of d are formed by taking the sum of the squares of the principal components but not dividing by the sample size.</p>
<p>Therefore we can devide by the sample size, which is either the ncol or nrow of the matrix -1.</p>
<pre class="sourceCode r" id="cb33"><code class="sourceCode r"><div class="sourceLine" id="cb33-1" data-line-number="1">p0<span class="op">$</span>d<span class="op">^</span><span class="dv">2</span><span class="op">/</span>(<span class="kw">nrow</span>(p0<span class="op">$</span>u) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</div></code></pre>
<pre><code>## [1] 1.4705472 0.5294528</code></pre>
<pre class="sourceCode r" id="cb35"><code class="sourceCode r"><div class="sourceLine" id="cb35-1" data-line-number="1">eigs=<span class="st"> </span>p0<span class="op">$</span>d<span class="op">^</span><span class="dv">2</span><span class="op">/</span>(<span class="kw">nrow</span>(p0<span class="op">$</span>u) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</div>
<div class="sourceLine" id="cb35-2" data-line-number="2">eigs</div></code></pre>
<pre><code>## [1] 1.4705472 0.5294528</code></pre>
<p>Summary of eigs</p>
<pre class="sourceCode r" id="cb37"><code class="sourceCode r"><div class="sourceLine" id="cb37-1" data-line-number="1">eigSum.svd=<span class="st"> </span><span class="kw">rbind</span>(</div>
<div class="sourceLine" id="cb37-2" data-line-number="2">  <span class="dt">eigs=</span> eigs,</div>
<div class="sourceLine" id="cb37-3" data-line-number="3">  <span class="dt">SD =</span> <span class="kw">sqrt</span>(eigs),</div>
<div class="sourceLine" id="cb37-4" data-line-number="4">  <span class="dt">Proportion =</span> eigs<span class="op">/</span><span class="kw">sum</span>(eigs),</div>
<div class="sourceLine" id="cb37-5" data-line-number="5">  <span class="dt">Cumulative =</span> <span class="kw">cumsum</span>(eigs)<span class="op">/</span><span class="kw">sum</span>(eigs))</div>
<div class="sourceLine" id="cb37-6" data-line-number="6">eigSum.svd</div></code></pre>
<pre><code>##                 [,1]      [,2]
## eigs       1.4705472 0.5294528
## SD         1.2126612 0.7276350
## Proportion 0.7352736 0.2647264
## Cumulative 0.7352736 1.0000000</code></pre>
<h2 id="prcomp">prcomp</h2>
<p>First stats::prcomp. The eigenvectors are stored in $rotation. Note these are the same as svd$v on scale data</p>
<pre class="sourceCode r" id="cb39"><code class="sourceCode r"><div class="sourceLine" id="cb39-1" data-line-number="1">p1&lt;-<span class="st"> </span><span class="kw">prcomp</span>(P, <span class="dt">scale =</span> <span class="ot">TRUE</span>)</div>
<div class="sourceLine" id="cb39-2" data-line-number="2">p1<span class="op">$</span>rotation</div></code></pre>
<pre><code>##             PC1        PC2
## x_obs 0.7071068 -0.7071068
## y_obs 0.7071068  0.7071068</code></pre>
<pre class="sourceCode r" id="cb41"><code class="sourceCode r"><div class="sourceLine" id="cb41-1" data-line-number="1"> (p1<span class="op">$</span>rotation<span class="op">==</span><span class="st"> </span>p0<span class="op">$</span>v)</div></code></pre>
<pre><code>##        PC1  PC2
## x_obs TRUE TRUE
## y_obs TRUE TRUE</code></pre>
<p>eigenvalues - sdev eigenvector - rotation</p>
<pre class="sourceCode r" id="cb43"><code class="sourceCode r"><div class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw">names</span>(p1)</div></code></pre>
<pre><code>## [1] &quot;sdev&quot;     &quot;rotation&quot; &quot;center&quot;   &quot;scale&quot;    &quot;x&quot;</code></pre>
<pre class="sourceCode r" id="cb45"><code class="sourceCode r"><div class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw">summary</span>(p1)</div></code></pre>
<pre><code>## Importance of components:
##                           PC1    PC2
## Standard deviation     1.2127 0.7276
## Proportion of Variance 0.7353 0.2647
## Cumulative Proportion  0.7353 1.0000</code></pre>
<p>To calculated eigenvalues information manually here is the code;</p>
<pre class="sourceCode r" id="cb47"><code class="sourceCode r"><div class="sourceLine" id="cb47-1" data-line-number="1">eigs=<span class="st"> </span>p1<span class="op">$</span>sdev<span class="op">^</span><span class="dv">2</span></div>
<div class="sourceLine" id="cb47-2" data-line-number="2">eigSum.pca=<span class="st"> </span><span class="kw">rbind</span>(</div>
<div class="sourceLine" id="cb47-3" data-line-number="3">  <span class="dt">eigs=</span>eigs,</div>
<div class="sourceLine" id="cb47-4" data-line-number="4">  <span class="dt">SD =</span> <span class="kw">sqrt</span>(eigs),</div>
<div class="sourceLine" id="cb47-5" data-line-number="5">  <span class="dt">Proportion =</span> eigs<span class="op">/</span><span class="kw">sum</span>(eigs),</div>
<div class="sourceLine" id="cb47-6" data-line-number="6">  <span class="dt">Cumulative =</span> <span class="kw">cumsum</span>(eigs)<span class="op">/</span><span class="kw">sum</span>(eigs))</div>
<div class="sourceLine" id="cb47-7" data-line-number="7"></div>
<div class="sourceLine" id="cb47-8" data-line-number="8">eigSum.pca</div></code></pre>
<pre><code>##                 [,1]      [,2]
## eigs       1.4705472 0.5294528
## SD         1.2126612 0.7276350
## Proportion 0.7352736 0.2647264
## Cumulative 0.7352736 1.0000000</code></pre>
<pre class="sourceCode r" id="cb49"><code class="sourceCode r"><div class="sourceLine" id="cb49-1" data-line-number="1"><span class="kw">identical</span>(eigSum.svd,eigSum.pca)</div></code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>If we had more components, we could generate a scree plot. Its not very useful with 2 components, but here is the code</p>
<p>Caculate the Proportion of Variance explained by each component (eig sum Proportion above)</p>
<pre class="sourceCode r" id="cb51"><code class="sourceCode r"><div class="sourceLine" id="cb51-1" data-line-number="1">ProportionVariance =<span class="st"> </span>p0<span class="op">$</span>d<span class="op">^</span><span class="dv">2</span> <span class="op">/</span><span class="kw">sum</span>(p0<span class="op">$</span>d<span class="op">^</span><span class="dv">2</span> )</div>
<div class="sourceLine" id="cb51-2" data-line-number="2">ProportionVariance</div></code></pre>
<pre><code>## [1] 0.7352736 0.2647264</code></pre>
<pre class="sourceCode r" id="cb53"><code class="sourceCode r"><div class="sourceLine" id="cb53-1" data-line-number="1"><span class="kw">plot</span>(ProportionVariance, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">type =</span> <span class="st">&quot;b&quot;</span>, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">xlab =</span> <span class="st">&quot;principal components&quot;</span>, </div>
<div class="sourceLine" id="cb53-2" data-line-number="2">    <span class="dt">ylab =</span> <span class="st">&quot;variance explained&quot;</span>)</div></code></pre>
<figure>
<img src="figure/unnamed-chunk-27-1.png" alt="plot of chunk unnamed-chunk-27" /><figcaption>plot of chunk unnamed-chunk-27</figcaption>
</figure>
<h1 id="princomp">princomp</h1>
<p>princomp was written for compatiblity with S-PLUS however it is not recommended. Its is better to use prcomp or svd. That is because by default princomp performs a decompostion of the covariance not correlation matrix. Princomp can call eigen on the correlation or covariance matrix. Its default calculation uses divisor N for the covariance matrix.</p>
<pre class="sourceCode r" id="cb54"><code class="sourceCode r"><div class="sourceLine" id="cb54-1" data-line-number="1">p2&lt;-stats<span class="op">::</span><span class="kw">princomp</span>(P)</div>
<div class="sourceLine" id="cb54-2" data-line-number="2">p2<span class="op">$</span>sd<span class="op">^</span><span class="dv">2</span></div></code></pre>
<pre><code>##   Comp.1   Comp.2 
## 4069.345 1177.556</code></pre>
<p>sqrt of eigenvalues</p>
<pre class="sourceCode r" id="cb56"><code class="sourceCode r"><div class="sourceLine" id="cb56-1" data-line-number="1">p2<span class="op">$</span>sdev</div></code></pre>
<pre><code>##   Comp.1   Comp.2 
## 63.79142 34.31553</code></pre>
<p>eigenvectors</p>
<pre class="sourceCode r" id="cb58"><code class="sourceCode r"><div class="sourceLine" id="cb58-1" data-line-number="1">p2<span class="op">$</span>loadings</div></code></pre>
<pre><code>## 
## Loadings:
##       Comp.1 Comp.2
## x_obs  0.453  0.892
## y_obs  0.892 -0.453
## 
##                Comp.1 Comp.2
## SS loadings       1.0    1.0
## Proportion Var    0.5    0.5
## Cumulative Var    0.5    1.0</code></pre>
<pre class="sourceCode r" id="cb60"><code class="sourceCode r"><div class="sourceLine" id="cb60-1" data-line-number="1"><span class="kw">head</span>(p2<span class="op">$</span>scores,<span class="dv">2</span>)</div></code></pre>
<pre><code>##         Comp.1     Comp.2
## [1,] -94.48864 -36.682917
## [2,] -99.33030   3.293649</code></pre>
<p>Set cor = TRUE in your call to princomp in order to perform PCA on the correlation matrix (instead of the covariance matrix)</p>
<pre class="sourceCode r" id="cb62"><code class="sourceCode r"><div class="sourceLine" id="cb62-1" data-line-number="1">p2b&lt;-<span class="kw">princomp</span>(P, <span class="dt">cor =</span> <span class="ot">TRUE</span>)</div>
<div class="sourceLine" id="cb62-2" data-line-number="2">p2b<span class="op">$</span>sdev<span class="op">^</span><span class="dv">2</span></div></code></pre>
<pre><code>##    Comp.1    Comp.2 
## 1.4705472 0.5294528</code></pre>
<pre class="sourceCode r" id="cb64"><code class="sourceCode r"><div class="sourceLine" id="cb64-1" data-line-number="1">p2b<span class="op">$</span>loadings</div></code></pre>
<pre><code>## 
## Loadings:
##       Comp.1 Comp.2
## x_obs  0.707  0.707
## y_obs  0.707 -0.707
## 
##                Comp.1 Comp.2
## SS loadings       1.0    1.0
## Proportion Var    0.5    0.5
## Cumulative Var    0.5    1.0</code></pre>
<p>For more info on prcomp v princomp see http://www.sthda.com/english/articles/31-principal-component-methods-in-r-practical-guide/118-principal-component-analysis-in-r-prcomp-vs-princomp/</p>
<h2 id="factominer">FactoMineR</h2>
<p>FactoMineR::PCA calls svd to compute the PCA</p>
<pre class="sourceCode r" id="cb66"><code class="sourceCode r"><div class="sourceLine" id="cb66-1" data-line-number="1">p3&lt;-FactoMineR<span class="op">::</span><span class="kw">PCA</span>(P)</div></code></pre>
<p><img src="figure/unnamed-chunk-34-1.png" alt="plot of chunk unnamed-chunk-34" /><img src="figure/unnamed-chunk-34-2.png" alt="plot of chunk unnamed-chunk-34" /></p>
<p>The eigenvalues, same as eigSum and eigSum.svd above</p>
<pre class="sourceCode r" id="cb67"><code class="sourceCode r"><div class="sourceLine" id="cb67-1" data-line-number="1"><span class="kw">t</span>(p3<span class="op">$</span>eig)</div></code></pre>
<pre><code>##                                      comp 1      comp 2
## eigenvalue                         1.470547   0.5294528
## percentage of variance            73.527362  26.4726382
## cumulative percentage of variance 73.527362 100.0000000</code></pre>
<h1 id="correlations-between-variables-and-pcs">correlations between variables and PCs</h1>
<pre class="sourceCode r" id="cb69"><code class="sourceCode r"><div class="sourceLine" id="cb69-1" data-line-number="1">p3<span class="op">$</span>var<span class="op">$</span>coord  </div></code></pre>
<pre><code>##          Dim.1      Dim.2
## x_obs 0.857481  0.5145157
## y_obs 0.857481 -0.5145157</code></pre>
<h2 id="ade4dudi.pca">ADE4::dudi.pca</h2>
<p>First ade4::dudi.pca scales the data and stores the scaled data in $tab. In PCA this will be almost equivalent to scale. However there is a minor difference (see https://pbil.univ-lyon1.fr/R/pdf/course2.pdf). ade4 usees the duality diagram framework for computing pca and other matrix factorizations (so it provides lw and cw which are the row and columns weights). See Cruz and Holmes 2011 for a wonderful tutorial on the duality diagram framework https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3265363/</p>
<pre class="sourceCode r" id="cb71"><code class="sourceCode r"><div class="sourceLine" id="cb71-1" data-line-number="1">p4&lt;-ade4<span class="op">::</span><span class="kw">dudi.pca</span>(P, <span class="dt">scannf =</span> <span class="ot">FALSE</span>, <span class="dt">nf=</span><span class="dv">2</span>)  <span class="co"># save 2 axis by default,</span></div>
<div class="sourceLine" id="cb71-2" data-line-number="2"><span class="kw">head</span>(p4<span class="op">$</span>tab)  <span class="co"># centered/scaled data. </span></div></code></pre>
<pre><code>##         x_obs      y_obs
## 1 -1.79410466 -1.1472082
## 2 -0.99902168 -1.5273772
## 3  0.02510543 -1.7859484
## 4 -1.88926469 -1.9735368
## 5 -1.11674143 -1.9968913
## 6 -0.94133545 -0.4822568</code></pre>
<pre class="sourceCode r" id="cb73"><code class="sourceCode r"><div class="sourceLine" id="cb73-1" data-line-number="1"><span class="kw">head</span>(<span class="kw">scale</span>(P))</div></code></pre>
<pre><code>##            x_obs      y_obs
## [1,] -1.78511160 -1.1414577
## [2,] -0.99401402 -1.5197211
## [3,]  0.02497959 -1.7769963
## [4,] -1.87979464 -1.9636443
## [5,] -1.11114369 -1.9868817
## [6,] -0.93661695 -0.4798394</code></pre>
<p>The values used for centering are stored in cent, it is a the colMeans. norm provides the sd of the columns</p>
<pre class="sourceCode r" id="cb75"><code class="sourceCode r"><div class="sourceLine" id="cb75-1" data-line-number="1">p4<span class="op">$</span>cent <span class="op">==</span><span class="st"> </span><span class="kw">colMeans</span>(P)</div></code></pre>
<pre><code>## x_obs y_obs 
##  TRUE  TRUE</code></pre>
<pre class="sourceCode r" id="cb77"><code class="sourceCode r"><div class="sourceLine" id="cb77-1" data-line-number="1">sd.n &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">sqrt</span>(<span class="kw">var</span>(x) <span class="op">*</span><span class="st"> </span>(<span class="kw">length</span>(x) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span><span class="kw">length</span>(x))</div>
<div class="sourceLine" id="cb77-2" data-line-number="2"><span class="kw">identical</span>(p4<span class="op">$</span>norm,<span class="kw">apply</span>(P, <span class="dv">2</span>, sd.n))</div></code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>The summary printout is equivalent to P3 (p3<span class="math inline"><em>e</em><em>i</em><em>g</em>)<em>a</em><em>b</em><em>o</em><em>v</em><em>e</em>.<em>T</em><em>h</em><em>e</em><em>e</em><em>i</em><em>g</em><em>e</em><em>n</em><em>v</em><em>a</em><em>l</em><em>e</em><em>s</em><em>a</em><em>r</em><em>e</em><em>s</em><em>t</em><em>o</em><em>r</em><em>e</em><em>d</em><em>i</em><em>n</em><em>p</em>4</span>eig.</p>
<pre class="sourceCode r" id="cb79"><code class="sourceCode r"><div class="sourceLine" id="cb79-1" data-line-number="1"><span class="kw">summary</span>(p4)</div></code></pre>
<pre><code>## Class: pca dudi
## Call: ade4::dudi.pca(df = P, scannf = FALSE, nf = 2)
## 
## Total inertia: 2
## 
## Eigenvalues:
##     Ax1     Ax2 
##  1.4705  0.5295 
## 
## Projected inertia (%):
##     Ax1     Ax2 
##   73.53   26.47 
## 
## Cumulative projected inertia (%):
##     Ax1   Ax1:2 
##   73.53  100.00</code></pre>
<pre class="sourceCode r" id="cb81"><code class="sourceCode r"><div class="sourceLine" id="cb81-1" data-line-number="1">p4<span class="op">$</span>eig</div></code></pre>
<pre><code>## [1] 1.4705472 0.5294528</code></pre>
<pre class="sourceCode r" id="cb83"><code class="sourceCode r"><div class="sourceLine" id="cb83-1" data-line-number="1">p4<span class="op">$</span>c1</div></code></pre>
<pre><code>##             CS1        CS2
## x_obs 0.7071068 -0.7071068
## y_obs 0.7071068  0.7071068</code></pre>
<pre class="sourceCode r" id="cb85"><code class="sourceCode r"><div class="sourceLine" id="cb85-1" data-line-number="1">p4<span class="op">$</span>co</div></code></pre>
<pre><code>##          Comp1      Comp2
## x_obs 0.857481 -0.5145157
## y_obs 0.857481  0.5145157</code></pre>
<p>The cumulative % of variance explained by each component ;</p>
<pre class="sourceCode r" id="cb87"><code class="sourceCode r"><div class="sourceLine" id="cb87-1" data-line-number="1">(k &lt;-<span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span>p4<span class="op">$</span>eig<span class="op">/</span><span class="kw">sum</span>(p4<span class="op">$</span>eig))</div></code></pre>
<pre><code>## [1] 73.52736 26.47264</code></pre>
<pre class="sourceCode r" id="cb89"><code class="sourceCode r"><div class="sourceLine" id="cb89-1" data-line-number="1"><span class="kw">cumsum</span>(k)</div></code></pre>
<pre><code>## [1]  73.52736 100.00000</code></pre>
<p>nf is an integer giving the number of axes kept. nf will always be lower that the number of row or columns of the matrix -1.</p>
<pre class="sourceCode r" id="cb91"><code class="sourceCode r"><div class="sourceLine" id="cb91-1" data-line-number="1">p4<span class="op">$</span>nf</div></code></pre>
<pre><code>## [1] 2</code></pre>
<p>c1 gives the variables’ coordinates, normed to 1. It is also called the coefficients of the combination or the loadings of variables. Equally the outpur matrix l1 gives the individuals’ coordinates, normed to 1. It is also called the loadings of individuals.</p>
<pre class="sourceCode r" id="cb93"><code class="sourceCode r"><div class="sourceLine" id="cb93-1" data-line-number="1">p4<span class="op">$</span>c1</div></code></pre>
<pre><code>##             CS1        CS2
## x_obs 0.7071068 -0.7071068
## y_obs 0.7071068  0.7071068</code></pre>
<pre class="sourceCode r" id="cb95"><code class="sourceCode r"><div class="sourceLine" id="cb95-1" data-line-number="1"><span class="kw">sum</span>(p4<span class="op">$</span>cw <span class="op">*</span><span class="st"> </span>p4<span class="op">$</span>c1<span class="op">$</span>CS1<span class="op">^</span><span class="dv">2</span>)</div></code></pre>
<pre><code>## [1] 1</code></pre>
<p>co gives the variables’ coordinates, normed to the square root of the eigenvalues.</p>
<pre class="sourceCode r" id="cb97"><code class="sourceCode r"><div class="sourceLine" id="cb97-1" data-line-number="1">p4<span class="op">$</span>co</div></code></pre>
<pre><code>##          Comp1      Comp2
## x_obs 0.857481 -0.5145157
## y_obs 0.857481  0.5145157</code></pre>
<pre class="sourceCode r" id="cb99"><code class="sourceCode r"><div class="sourceLine" id="cb99-1" data-line-number="1"><span class="kw">sum</span>(p4<span class="op">$</span>cw <span class="op">*</span><span class="st"> </span>p4<span class="op">$</span>co<span class="op">$</span>Comp1<span class="op">^</span><span class="dv">2</span>)</div></code></pre>
<pre><code>## [1] 1.470547</code></pre>
<p>The link between c1 and co is defined by:</p>
<pre class="sourceCode r" id="cb101"><code class="sourceCode r"><div class="sourceLine" id="cb101-1" data-line-number="1">p4<span class="op">$</span>c1<span class="op">$</span>CS1 <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(p4<span class="op">$</span>eig[<span class="dv">1</span>])</div></code></pre>
<pre><code>## [1] 0.857481 0.857481</code></pre>
<h2 id="comparision-of-results-of-different-methods">Comparision of results of different methods</h2>
<p>There is also a nice package called factoextra. This works all of the above classes</p>
<pre class="sourceCode r" id="cb103"><code class="sourceCode r"><div class="sourceLine" id="cb103-1" data-line-number="1"><span class="kw">library</span>(factoextra)</div>
<div class="sourceLine" id="cb103-2" data-line-number="2"></div>
<div class="sourceLine" id="cb103-3" data-line-number="3">res&lt;-<span class="st"> </span><span class="kw">list</span>(p0,p1,p2,p2b,p3,p4) </div>
<div class="sourceLine" id="cb103-4" data-line-number="4"><span class="kw">names</span>(res) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;svd_scaledData&#39;</span>,<span class="st">&#39;prcomp&#39;</span>, <span class="st">&#39;princomp&#39;</span>,<span class="st">&#39;princomp_cov&#39;</span>, <span class="st">&#39;FactoMineR&#39;</span>, <span class="st">&#39;ade4&#39;</span>)</div>
<div class="sourceLine" id="cb103-5" data-line-number="5"></div>
<div class="sourceLine" id="cb103-6" data-line-number="6">e&lt;-<span class="kw">sapply</span>(res[<span class="op">-</span><span class="dv">1</span>],get_eig)</div>
<div class="sourceLine" id="cb103-7" data-line-number="7"></div>
<div class="sourceLine" id="cb103-8" data-line-number="8"><span class="co"># get_eig doesn&#39;t work on svd</span></div>
<div class="sourceLine" id="cb103-9" data-line-number="9">svd.e&lt;-<span class="st"> </span><span class="kw">t</span>(eigSum.svd[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">4</span>),])</div>
<div class="sourceLine" id="cb103-10" data-line-number="10">svd.e[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>]&lt;-svd.e[,<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>]<span class="op">*</span><span class="dv">100</span>  <span class="co"># Convert to %</span></div>
<div class="sourceLine" id="cb103-11" data-line-number="11"><span class="kw">colnames</span>(svd.e)&lt;-<span class="st"> </span><span class="kw">names</span>(e[[<span class="dv">1</span>]])</div>
<div class="sourceLine" id="cb103-12" data-line-number="12"></div>
<div class="sourceLine" id="cb103-13" data-line-number="13"></div>
<div class="sourceLine" id="cb103-14" data-line-number="14">e&lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">list</span>(<span class="dt">svd=</span>svd.e),e)</div>
<div class="sourceLine" id="cb103-15" data-line-number="15"></div>
<div class="sourceLine" id="cb103-16" data-line-number="16">e</div></code></pre>
<pre><code>## $svd
##      eigenvalue variance.percent cumulative.variance.percent
## [1,]  1.4705472         73.52736                    73.52736
## [2,]  0.5294528         26.47264                   100.00000
## 
## $prcomp
##       eigenvalue variance.percent cumulative.variance.percent
## Dim.1  1.4705472         73.52736                    73.52736
## Dim.2  0.5294528         26.47264                   100.00000
## 
## $princomp
##       eigenvalue variance.percent cumulative.variance.percent
## Dim.1   4069.345         77.55712                    77.55712
## Dim.2   1177.556         22.44288                   100.00000
## 
## $princomp_cov
##       eigenvalue variance.percent cumulative.variance.percent
## Dim.1  1.4705472         73.52736                    73.52736
## Dim.2  0.5294528         26.47264                   100.00000
## 
## $FactoMineR
##       eigenvalue variance.percent cumulative.variance.percent
## Dim.1  1.4705472         73.52736                    73.52736
## Dim.2  0.5294528         26.47264                   100.00000
## 
## $ade4
##       eigenvalue variance.percent cumulative.variance.percent
## Dim.1  1.4705472         73.52736                    73.52736
## Dim.2  0.5294528         26.47264                   100.00000</code></pre>
<h1 id="visualization-and-exploration-of-results">Visualization and Exploration of results</h1>
<p>The github package https://github.com/juba/explor is useful for exploring data. It includes plotting functions for many packages including ade4, FactoMineR and baseR functions prcomp and princomp;</p>
<p>For now on, it is usable the following types of analyses :</p>
<table style="width:67%;">
<colgroup>
<col style="width: 19%" />
<col style="width: 19%" />
<col style="width: 15%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="header">
<th>Analysis</th>
<th>Function</th>
<th>Package</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Principal Component Analysis</td>
<td>PCA</td>
<td><a href="http://factominer.free.fr/">FactoMineR</a></td>
<td>-</td>
</tr>
<tr class="even">
<td>Correspondance Analysis</td>
<td>CA</td>
<td><a href="http://factominer.free.fr/">FactoMineR</a></td>
<td>-</td>
</tr>
<tr class="odd">
<td>Multiple Correspondence Analysis</td>
<td>MCA</td>
<td><a href="http://factominer.free.fr/">FactoMineR</a></td>
<td>-</td>
</tr>
<tr class="even">
<td>Principal Component Analysis</td>
<td>dudi.pca</td>
<td><a href="https://cran.r-project.org/package=ade4">ade4</a></td>
<td>Qualitative supplementary variables are ignored</td>
</tr>
<tr class="odd">
<td>Correspondance Analysis</td>
<td>dudi.coa</td>
<td><a href="https://cran.r-project.org/package=ade4">ade4</a></td>
<td>-</td>
</tr>
<tr class="even">
<td>Multiple Correspondence Analysis</td>
<td>dudi.acm</td>
<td><a href="https://cran.r-project.org/package=ade4">ade4</a></td>
<td>Quantitative supplementary variables are ignored</td>
</tr>
<tr class="odd">
<td>Specific Multiple Correspondance Analysis</td>
<td>speMCA</td>
<td><a href="https://cran.r-project.org/package=GDAtools">GDAtools</a></td>
<td>Supplementary variables are not supported</td>
</tr>
<tr class="even">
<td>Multiple Correspondance Analysis</td>
<td>mca</td>
<td><a href="https://cran.r-project.org/package=MASS">MASS</a></td>
<td>Quantitative supplementary variables are not supported</td>
</tr>
<tr class="odd">
<td>Principal Component Analysis</td>
<td>princomp</td>
<td>stats</td>
<td>Supplementary variables are ignored</td>
</tr>
<tr class="even">
<td>Principal Component Analysis</td>
<td>prcomp</td>
<td>stats</td>
<td>Supplementary variables are ignored</td>
</tr>
</tbody>
</table>
<pre class="sourceCode r" id="cb105"><code class="sourceCode r"><div class="sourceLine" id="cb105-1" data-line-number="1"><span class="cf">if</span>(<span class="op">!</span><span class="st">&quot;explor&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(<span class="kw">installed.packages</span>()))    devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;juba/explor&quot;</span>)</div>
<div class="sourceLine" id="cb105-2" data-line-number="2"></div>
<div class="sourceLine" id="cb105-3" data-line-number="3"><span class="cf">if</span>(<span class="op">!</span><span class="st">&quot;scatterD3&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">rownames</span>(<span class="kw">installed.packages</span>())) </div>
<div class="sourceLine" id="cb105-4" data-line-number="4">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;juba/scatterD3&quot;</span>)</div></code></pre>
<pre class="sourceCode r" id="cb106"><code class="sourceCode r"><div class="sourceLine" id="cb106-1" data-line-number="1"><span class="kw">require</span>(explor)</div>
<div class="sourceLine" id="cb106-2" data-line-number="2">explor<span class="op">::</span><span class="kw">explor</span>(p4)</div></code></pre>
<pre class="sourceCode r" id="cb107"><code class="sourceCode r"><div class="sourceLine" id="cb107-1" data-line-number="1"><span class="kw">data</span>(children)</div>
<div class="sourceLine" id="cb107-2" data-line-number="2">res.ca &lt;-<span class="st"> </span><span class="kw">CA</span>(children, <span class="dt">row.sup =</span> <span class="dv">15</span><span class="op">:</span><span class="dv">18</span>, <span class="dt">col.sup =</span> <span class="dv">6</span><span class="op">:</span><span class="dv">8</span>)</div>
<div class="sourceLine" id="cb107-3" data-line-number="3"><span class="kw">explor</span>(res.ca)</div></code></pre>
<h2 id="factoextra">factoextra</h2>
<p>Plotting using factoextra</p>
<pre class="sourceCode r" id="cb108"><code class="sourceCode r"><div class="sourceLine" id="cb108-1" data-line-number="1"><span class="kw">library</span>(factoextra)</div></code></pre>
<pre class="sourceCode r" id="cb109"><code class="sourceCode r"><div class="sourceLine" id="cb109-1" data-line-number="1"><span class="kw">fviz_eig</span>(p1)</div></code></pre>
<figure>
<img src="figure/unnamed-chunk-50-1.png" alt="plot of chunk unnamed-chunk-50" /><figcaption>plot of chunk unnamed-chunk-50</figcaption>
</figure>
<pre class="sourceCode r" id="cb110"><code class="sourceCode r"><div class="sourceLine" id="cb110-1" data-line-number="1"><span class="kw">fviz_pca_var</span>(p1,</div>
<div class="sourceLine" id="cb110-2" data-line-number="2">             <span class="dt">col.var =</span> <span class="st">&quot;contrib&quot;</span>, <span class="co"># Color by contributions to the PC</span></div>
<div class="sourceLine" id="cb110-3" data-line-number="3">             <span class="dt">gradient.cols =</span> <span class="kw">c</span>(<span class="st">&quot;#00AFBB&quot;</span>, <span class="st">&quot;#E7B800&quot;</span>, <span class="st">&quot;#FC4E07&quot;</span>),</div>
<div class="sourceLine" id="cb110-4" data-line-number="4">             <span class="dt">repel =</span> <span class="ot">TRUE</span>     <span class="co"># Avoid text overlapping</span></div>
<div class="sourceLine" id="cb110-5" data-line-number="5">             )</div></code></pre>
<figure>
<img src="figure/unnamed-chunk-51-1.png" alt="plot of chunk unnamed-chunk-51" /><figcaption>plot of chunk unnamed-chunk-51</figcaption>
</figure>
<pre class="sourceCode r" id="cb111"><code class="sourceCode r"><div class="sourceLine" id="cb111-1" data-line-number="1"><span class="kw">fviz_pca_biplot</span>(p1, <span class="dt">repel =</span> <span class="ot">TRUE</span>,</div>
<div class="sourceLine" id="cb111-2" data-line-number="2">                <span class="dt">col.var =</span> <span class="st">&quot;#2E9FDF&quot;</span>, <span class="co"># Variables color</span></div>
<div class="sourceLine" id="cb111-3" data-line-number="3">                <span class="dt">col.ind =</span> <span class="st">&quot;#696969&quot;</span>  <span class="co"># Individuals color</span></div>
<div class="sourceLine" id="cb111-4" data-line-number="4">                )</div></code></pre>
<figure>
<img src="figure/unnamed-chunk-52-1.png" alt="plot of chunk unnamed-chunk-52" /><figcaption>plot of chunk unnamed-chunk-52</figcaption>
</figure>
<h1 id="drawing-ellispe">Drawing Ellispe</h1>
<p>Example using iris dataset</p>
<pre class="sourceCode r" id="cb112"><code class="sourceCode r"><div class="sourceLine" id="cb112-1" data-line-number="1"><span class="kw">data</span>(iris)</div>
<div class="sourceLine" id="cb112-2" data-line-number="2">ir.pca&lt;-<span class="kw">prcomp</span>(<span class="kw">log</span>(iris[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]), <span class="dt">center=</span><span class="ot">TRUE</span>, <span class="dt">scale=</span><span class="ot">TRUE</span>)</div></code></pre>
<p>Easiest approach:</p>
<pre class="sourceCode r" id="cb113"><code class="sourceCode r"><div class="sourceLine" id="cb113-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</div>
<div class="sourceLine" id="cb113-2" data-line-number="2"><span class="kw">library</span>(ggfortify)</div>
<div class="sourceLine" id="cb113-3" data-line-number="3">ggplot2<span class="op">::</span><span class="kw">autoplot</span>(ir.pca, <span class="dt">data=</span>iris, <span class="dt">colour=</span><span class="st">&quot;Species&quot;</span>, <span class="dt">frame=</span><span class="ot">TRUE</span>, <span class="dt">frame.type=</span><span class="st">&quot;t&quot;</span>) </div></code></pre>
<figure>
<img src="figure/unnamed-chunk-54-1.png" alt="plot of chunk unnamed-chunk-54" /><figcaption>plot of chunk unnamed-chunk-54</figcaption>
</figure>
<pre class="sourceCode r" id="cb114"><code class="sourceCode r"><div class="sourceLine" id="cb114-1" data-line-number="1"><span class="kw">library</span>(ggplot2)</div>
<div class="sourceLine" id="cb114-2" data-line-number="2"><span class="kw">ggplot</span>(ir.pca,<span class="kw">aes</span>(PC1, PC2))<span class="op">+</span><span class="st"> </span></div>
<div class="sourceLine" id="cb114-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></div>
<div class="sourceLine" id="cb114-4" data-line-number="4"><span class="st">  </span><span class="kw">stat_density_2d</span>(<span class="kw">aes</span>(<span class="dt">alpha=</span>..level.., <span class="dt">fill=</span>iris<span class="op">$</span>Species), <span class="dt">bins=</span><span class="dv">4</span>, <span class="dt">geom=</span><span class="st">&quot;polygon&quot;</span>)</div></code></pre>
<figure>
<img src="figure/unnamed-chunk-55-1.png" alt="plot of chunk unnamed-chunk-55" /><figcaption>plot of chunk unnamed-chunk-55</figcaption>
</figure>
<p>stat_ellipse() and stat_density_2d() have a lot of options. See manual pages</p>
<p>multivariate normal distribution.</p>
<pre><code>stat_ellipse(type = &quot;norm&quot;, linetype = 2)  </code></pre>
<p>Euclid, is a circle with radius = level</p>
<pre><code>stat_ellipse(type = &quot;euclid&quot;, level = 3) </code></pre>
<p>multivariate t-distribution</p>
<pre><code>stat_ellipse(type = &quot;t&quot;) </code></pre>
